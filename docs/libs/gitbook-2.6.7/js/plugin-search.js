gitbook.require(["gitbook","lodash","jQuery"],function(gitbook,_,$){function loadIndex(data){index=lunr(function(){this.ref("url"),this.field("title",{boost:10}),this.field("body")}),data.map(function(item){index.add({url:item[0],title:item[1],body:item[2]})})}function fetchIndex(){return $.getJSON(gitbook.state.basePath+"/search_index.json").then(loadIndex)}function search(q){if(index){var results=_.chain(index.search(q)).map(function(result){var parts=result.ref.split("#");return{path:parts[0],hash:parts[1]}}).value();return $highlighted=0===results.length?[]:$(".page-inner").unhighlight(hiOpts).highlight(q,hiOpts).find("span.search-highlight"),scrollToHighlighted(0),results}}function scrollToHighlighted(d){var n=$highlighted.length;hi=void 0===hi?0:hi+d;var b=0>hi;if(0!==d&&(b||hi>=n)){var path=currentPath(),n2=toc_visible.length;if(0===n2)return;for(var i=b?0:n2;(b&&n2>i||!b&&i>=0)&&toc_visible.eq(i).data("path")!==path;i+=b?1:-1);i+=b?-1:1,0>i&&(i=n2-1),i>=n2&&(i=0);var lnk=toc_visible.eq(i).find('a[href$=".html"]');return void(lnk.length&&lnk[0].click())}if(0!==n){var $p=$highlighted.eq(hi);$p[0].scrollIntoView(),$highlighted.css("background-color",""),$p.css("background-color","orange"),setTimeout(function(){$p.css("background-color","")},2e3)}}function currentPath(){var href=window.location.pathname;return href=href.substr(href.lastIndexOf("/")+1),""===href?"index.html":href}function createForm(value){$searchForm&&$searchForm.remove(),$searchLabel&&$searchLabel.remove(),$searchInput&&$searchInput.remove(),$searchForm=$("<div>",{"class":"book-search",role:"search"}),$searchLabel=$("<label>",{"for":"search-box","aria-hidden":"false",hidden:""}),$searchInput=$("<input>",{id:"search-box",type:"search","class":"form-control",val:value,placeholder:"Type to search (Enter for navigation)",title:"Use Enter or the <Down> key to navigate to the next match, or the <Up> key to the previous match"}),$searchLabel.append("Type to search"),$searchLabel.appendTo($searchForm),$searchInput.appendTo($searchForm),$searchForm.prependTo(gitbook.state.$book.find(".book-summary"))}function isSearchOpen(){return gitbook.state.$book.hasClass("with-search")}function toggleSearch(_state){isSearchOpen()!==_state&&$searchInput&&(gitbook.state.$book.toggleClass("with-search",_state),isSearchOpen()?(gitbook.sidebar.toggle(!0),$searchInput.focus()):($searchInput.blur(),$searchInput.val(""),gitbook.storage.remove("keyword"),gitbook.sidebar.filter(null),$(".page-inner").unhighlight(hiOpts)))}function sidebarFilter(results){gitbook.sidebar.filter(_.pluck(results,"path")),toc_visible=$("ul.summary").find("li:visible")}function recoverSearch(){var keyword=gitbook.storage.get("keyword","");createForm(keyword),keyword.length>0&&(isSearchOpen()||toggleSearch(!0),sidebarFilter(search(keyword)))}var $searchInput,$searchLabel,$searchForm,hi,index=null,$highlighted=[],hiOpts={className:"search-highlight"},collapse=!1,toc_visible=[];gitbook.events.bind("start",function(e,config){config.search!==!1&&(collapse=!config.toc||"section"===config.toc.collapse||"subsection"===config.toc.collapse,fetchIndex().then(recoverSearch),$(document).on("keyup",".book-search input",function(e){var key=e.keyCode?e.keyCode:e.which;27==key?(e.preventDefault(),toggleSearch(!1)):38==key?scrollToHighlighted(-1):(40==key||13==key)&&scrollToHighlighted(1)}).on("input",".book-search input",function(){var q=$(this).val().trim();if(0===q.length)gitbook.sidebar.filter(null),gitbook.storage.remove("keyword"),$(".page-inner").unhighlight(hiOpts);else{var results=search(q);sidebarFilter(results),gitbook.storage.set("keyword",q)}}),gitbook.toolbar.createButton({icon:"fa fa-search",label:"Search",position:"left",onClick:toggleSearch}),gitbook.keyboard.bind(["f"],toggleSearch))})});
